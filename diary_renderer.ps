/pagePaddingTB pagePaddingTB 3 div def

/oldCageHeight cageHeight def
/cageWidth pageW 2 div pagePaddingLR 2 mul sub def
/cageHeight pageH 2 div pagePaddingTB 2 mul sub def

%!ps

%calculate the new scaling. slightly reduce the calculated value-
%for better spacing between rows.
/newFontScale cageHeight oldCageHeight div .8 mul def
%rescale all the parameters
/headerFontHeight headerFontHeight newFontScale mul def
/dateFontHeight dateFontHeight newFontScale mul def
/LegendFontHeight LegendFontHeight newFontScale mul def
/poyacircleRadius poyacircleRadius newFontScale mul def
/holidayRectWidth holidayRectWidth newFontScale mul def

/headerHeight headerHeight newFontScale mul def
/cageHeight cageHeight headerHeight sub def

/gridLinePitch 7 mm def

%llcX, llcY, width, height
/exercise_book_page {
	/ph exch def
	/pw exch def
	/py0 exch def
	/px0 exch def
	%/gridLinePitch ph pagePaddingTB 2 mul sub lineCount div def
	/lineCount ph pagePaddingTB sub gridLinePitch div truncate def
	
	/x px0 pagePaddingLR add def
	/y py0 gridLinePitch 2 mul add def
	%/lineCount 1 sub def
	.26 .64 .96 setrgbcolor
	2 1 lineCount {
        /lineIndex exch def
        %gridLinePitch ==
        x y moveto
        x pw pagePaddingTB 2 mul
        sub add y lineto
        stroke
        /y y gridLinePitch add def
        %y ==
        
	} for
	%draw the margin line (red-just margin)
	/justMarginGap .75 inch def
	.90 .24 .34 setrgbcolor
	/x px0 pagePaddingLR add justMarginGap add def
	x py0 pagePaddingTB add moveto
	x py0 ph add pagePaddingTB sub lineto
	stroke
} def

1 2 12 {
    /monthIndex exch def
    /xStart pagePaddingLR def
    /yStart pageH pagePaddingTB sub cageHeight headerHeight add sub def

    calYear monthIndex xStart yStart DrawMonth
    pageW 2 div pageH 2 div pageW 2 div pageH 2 div exercise_book_page

    /yStart yStart cageHeight headerHeight add pagePaddingTB 2 mul add sub def
    calYear monthIndex 1 add xStart yStart DrawMonth
    pageW 2 div 0 pageW 2 div pageH 2 div exercise_book_page
    
    showpage
} for

