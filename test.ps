%!ps
/mm {2.83465 mul} def
/point_mm {1 mm div} def

/Message (0 Hello World 123) def
/FontHeight 36 def
/Leading FontHeight 10 add def
/PosX 100 def
/PosY 750 def
/w [(Mo) (Tu) (We) (Th) (Fr) (Sa) (Su)] def
/months [(January) (February) (March) (April) (May) (June) (July) (August) (September) (October) (November) (December)] def
/cageHeight 40 mm def
/headerHeight 8 mm def
/cageWidth 50 mm def
/headerFontHeight 4.5 mm def
/dateHeight 3 mm def

/BullsEye {
	newpath
	2 copy
	5 0 360 arc
	moveto
	-20 0 rlineto
	40 0 rlineto
	-20 -20 rmoveto
	0 40 rlineto
	.5 setlinewidth
	stroke
} def

/Newline {
	/PosY PosY Leading sub def
	PosX PosY
	%2 copy BullsEye
	moveto
} def

/DrawText {
	/Courier findfont FontHeight scalefont setfont
	Newline
	newpath
	PosX PosY moveto
	dup stringwidth pop 0 rlineto
	stroke
	PosX PosY moveto
	show
} def

/getTextHeight {
    % Get the font dictionary and retrieve FontBBox
    gsave
    currentfont /FontBBox get % Get FontBBox array [llx lly urx ury]
    dup 3 get                    % Extract lly (bottom)
    exch 1 get                    % Extract ury (top)
    sub                      % Subtract bottom from top (height)
    currentfont /FontMatrix get 0 get mul % Scale to font size
    grestore
} def

%year
/isLeapYear {
	/y exch def
	y 4 mod 0 eq y 100 mod 0 ne and y 400 mod 0 eq or	
} def

%Find number of days of a given month in a given year
%year month
/noOfDays {
	/m exch def
	/y exch def
	1 3 5 7 8 10 12 
	m eq
	6 {
		exch m eq or
	} repeat
	{31} {
		4 6 9 11
		m eq
		3 {
			exch m eq or
		} repeat
		{30} {y isLeapYear {29} {28} ifelse} ifelse
	} ifelse
} def

%year month day
/dayOfWeek {
	/d exch def
	/m exch def
	/y exch def
	/t [0 3 2 5 0 3 5 1 4 6 2 4] def
	m 3 lt {/y y 1 sub def} if
	y y 4 idiv add y 100 idiv sub y 400 idiv add t m 1 sub get add d add 7 mod	%index for week starting from Sunday
	6 add 7 mod	%adjustment for week starting from Monday
	%w exch get
	%==
} def

%year monthIndex
/FillMonthGrid {
	/month exch def
	/year exch def
	/days year month noOfDays def
	/arr 35 array def
	/firstDay year month 1 dayOfWeek def
	0 1 34 {
		arr exch (*) put
	} for

	firstDay 1 firstDay days add 1 sub{
		/tmpStr 2 string def
		dup /intDay exch firstDay sub 1 add def
		intDay 10 lt {/tmpStr 1 string def} if
		intDay tmpStr cvs pop
		arr exch 35 mod tmpStr  put
	} for
	arr dup ==
} def

%string x y
/DrawText_center_aligned {
	gsave
		moveto
		/fScale currentfont /FontMatrix get 0 get def
		dup stringwidth pop 2 div neg
		currentfont /FontBBox get
		dup 3 get 2 div exch 1 get add neg fScale  mul
		rmoveto
		show
	grestore

} def

%string x y
/DrawText_right_aligned {
	gsave
		moveto
		/fScale currentfont /FontMatrix get 0 get def
		dup stringwidth pop neg
		currentfont /FontBBox get
		dup 3 get 2 div exch 1 get add neg fScale mul
		rmoveto
		show
	grestore
} def

%string x y
/DrawText_baseline_right_aligned {
	gsave
		moveto
		/fScale currentfont /FontMatrix get 0 get def
		dup stringwidth pop neg
		0 rmoveto
		show
	grestore
} def

%upperRight {x, y}
/DrawMonthCage {
	2 copy	
	%2 copy	BullsEye
	cageWidth cageHeight headerHeight add rectstroke

	cageHeight add
	cageWidth headerHeight rectstroke
	
} def

%str1 str2
/strcat {
	/str2 exch def
	/str1 exch def
	/strNew str1 length str2 length add string def
	strNew 0 str1 putinterval
	strNew str1 length str2 putinterval
	strNew
} def

%year monthIndex llcX llcY
/DrawMonth {
	/y0 exch def
	/x0 exch def
	/monthIndex exch def
	/year exch def
	x0 y0 DrawMonthCage
	/Helvetica findfont headerFontHeight scalefont setfont
	/headerCenterX x0 cageWidth 2  div add def
	/headerCenterY y0 cageHeight headerHeight 2 div add add def
	headerCenterX headerCenterY BullsEye
	months monthIndex 1 sub get headerCenterX headerCenterY DrawText_center_aligned

	%draw the days header
	%get the widths of all characters in the days header (SuMoTu...)
	/Helvetica findfont dateHeight scalefont setfont
	()	%puhs empty string first
	w {
		strcat
	} forall
	stringwidth pop dup ==
	cageWidth exch sub 8 div	% calculate the x  spacing value
	/incX exch def
	%calculate y spacing value (row spacing))
	cageHeight 7 div
	/incY exch def
	w 0 get stringwidth pop
	/x exch x0 add incX add def
	/yPos y0 cageHeight add incY sub dateHeight sub def
	/posArr 7 array def
	/arrayIndex 0 def
	w {
		dup
		posArr arrayIndex x put
		/arrayIndex arrayIndex 1 add def
		x yPos DrawText_baseline_right_aligned
		/x exch stringwidth pop incX add x add def
	} forall
	/mArr year monthIndex FillMonthGrid def
	0 1 34 {
		/i exch def
		/weekI i 7 mod def
		weekI 0 eq{
			%start of a new week row
			/yPos yPos incY sub dateHeight sub def
		} if
		mArr i get posArr weekI get yPos DrawText_baseline_right_aligned
	}for

} def

2 2 scale

2024 12 7 mm 15 mm DrawMonth

%getTextHeight ==
%(January) stringwidth pop ==

%(0 Hello World ## 123) DrawText
%ifTest
%loopTest
%10.5 20.5 funcTest
%2024 12 noOfDays
%4 isLeapYear ==
%arrayTest
%2012 2 29 dayOfWeek

